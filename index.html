<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Steel Strategy Board (4x4)</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  /* Hue Shifted Background: Dark Slate/Gunmetal */
  background: radial-gradient(circle at center, #242c33, #12161a);
  /* Text Color: Cool Grey/Silver */
  color:#aab9cc;
  font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  user-select: none;
}

h2{
  margin:20px 0 10px;
  letter-spacing:2px;
  text-shadow: 2px 2px 0px #000;
  font-weight: 800;
  /* Title: Pale Cyan/Steel */
  color: #c5d8e6;
}

.panel{
  display:flex;
  gap:10px;
  margin-bottom:15px;
  background: rgba(0,0,0,0.3);
  padding: 10px;
  border-radius: 12px;
  /* Panel Border: Dark Slate */
  border: 1px solid #374852;
}

select,button{
  /* Button Gradient: Muted Blue/Steel */
  background: linear-gradient(to bottom, #405c75, #374852);
  color:#e0eaff;
  /* Button Border */
  border:1px solid #252d33;
  padding:8px 16px;
  font-size:14px;
  font-weight: bold;
  border-radius:6px;
  cursor:pointer;
  box-shadow: 0 4px 0 #252d33;
  transition: transform 0.1s;
}
select:hover,button:hover{
  filter: brightness(1.2) saturate(0.8);
}
select:active,button:active{
  transform: translateY(4px);
  box-shadow: 0 0 0 #252d33;
}

#turn{
  margin:5px 0 15px;
  font-weight:bold;
  letter-spacing:1px;
  font-size: 1.1em;
  /* Turn Indicator Background */
  background: #252d33;
  padding: 5px 15px;
  border-radius: 20px;
  border: 1px solid #405c75;
  color: #9daab5;
}

.board-frame{
  /* Board Base: Metallic Silver/Grey */
  background-color: #9daab5;
  background-image: linear-gradient(45deg, rgba(0,0,0,0.05) 25%, transparent 25%, transparent 75%, rgba(0,0,0,0.05) 75%, rgba(0,0,0,0.05)), 
                    linear-gradient(45deg, rgba(0,0,0,0.05) 25%, transparent 25%, transparent 75%, rgba(0,0,0,0.05) 75%, rgba(0,0,0,0.05));
  background-size: 40px 80px;
  background-position: 0 0, 20px 40px;
  padding:20px;
  border-radius:12px;
  /* Board Border: Thick Dark Steel */
  border: 8px solid #374852;
  box-shadow:
    inset 0 0 20px rgba(0,0,0,0.5),
    0 20px 50px rgba(0,0,0,0.8);
  position: relative;
}

.board-frame::after {
  content: '';
  position: absolute;
  top: -8px; left: -8px; right: -8px; bottom: -8px;
  border-radius: 12px;
  border: 2px solid #252d33;
  pointer-events: none;
}

canvas{
  display:block;
  cursor: pointer;
}

.footer{
  margin-top:20px;
  opacity:.5;
  font-size:12px;
  font-style: italic;
  color: #7a8b99;
}
</style>
</head>

<body>

<h2>Tjatur Djawa (4X4)</h2>

<div class="panel">
  <select id="mode">
    <option value="2P">2 PLAYER</option>
    <option value="EASY">AI EASY (VS Hitam)</option>
    <option value="MEDIUM">AI MEDIUM (VS Hitam)</option>
    <option value="HARD">AI HARD (VS Hitam)</option>
    <option value="AI-VS-AI">AI VS AI (Contoh)</option>
  </select>
  <button onclick="resetGame()">RESET BOARD</button>
</div>

<h3 id="turn">TURN: WHITE</h3>

<div class="board-frame">
  <canvas id="game" width="380" height="380"></canvas>
</div>

<div class="footer">Tjatur Djawa 5-Piece build 2.100.00M · Nidroverse Corp. ©2026</div>

<script>
const c=document.getElementById("game"),ctx=c.getContext("2d");

// --- GENERATING 4x4 GRID SYSTEM ---
const GRID_SIZE = 4; 
const CELL_SIZE = 80;
const OFFSET = 70; 
let N = []; 
let L = []; 
let W = []; 

// 1. Generate Coordinates
for(let y=0; y<GRID_SIZE; y++){
  for(let x=0; x<GRID_SIZE; x++){
    N.push({x: OFFSET + x*CELL_SIZE, y: OFFSET + y*CELL_SIZE});
  }
}

// 2. Generate Connections
function addLine(u, v) {
  if(!L.some(l => (l[0]===u && l[1]===v) || (l[0]===v && l[1]===u))) {
    L.push([u,v]);
  }
}
for(let i=0; i<16; i++){
  let x = i % 4;
  let y = Math.floor(i / 4);
  if(x < 3) addLine(i, i+1);
  if(y < 3) addLine(i, i+4);
  if(x < 3 && y < 3) addLine(i, i+5);
  if(x > 0 && y < 3) addLine(i, i+3);
}

// 3. Generate Winning Lines
for(let r=0; r<4; r++) W.push([r*4, r*4+1, r*4+2, r*4+3]);
for(let c=0; c<4; c++) W.push([c, c+4, c+8, c+12]);
W.push([0, 5, 10, 15]);
W.push([3, 6, 9, 12]);

// --- GAME LOGIC ---
let board, turn, sel=null, mode="2P";

// Audio - Updated for "Metallic" sound
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playWoodSound() {
  if (audioCtx.state === 'suspended') audioCtx.resume();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  
  // Metallic "Clink" sound
  osc.type = "triangle"; 
  osc.frequency.setValueAtTime(800, audioCtx.currentTime); 
  osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.08);
  
  gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
  
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + 0.1);
}

// Animasi
let animState = { active: false, fromIdx: -1, toIdx: -1, progress: 0, player: null };

function resetGame(){
 board=Array(16).fill(null);
 board[0]=board[1]=board[2]=board[3]=board[4]="RED"; 
 board[15]=board[14]=board[13]=board[12]=board[11]="BLUE";

 turn="BLUE"; sel=null; 
 document.getElementById("turn").innerText="TURN: WHITE (BLUE)";
 animState.active = false;
 draw();
 
 if(mode === "AI-VS-AI") {
   setTimeout(aiMove, 1000);
 }
}
document.getElementById("mode").onchange=e=>mode=e.target.value;
resetGame();

function draw(){
 ctx.clearRect(0,0,380,380);
 
 // Draw Lines - CHANGED: Dark Slate Blue
 ctx.lineWidth=6; ctx.lineCap = "round"; 
 ctx.strokeStyle="rgba(45, 55, 65, 0.6)"; 
 L.forEach(l=>{ctx.beginPath();ctx.moveTo(N[l[0]].x,N[l[0]].y);ctx.lineTo(N[l[1]].x,N[l[1]].y);ctx.stroke();});
 
 // Draw Points - CHANGED: Dark Slate
 N.forEach((n,i)=>{
  ctx.beginPath(); ctx.arc(n.x,n.y,6,0,Math.PI*2); 
  ctx.fillStyle = "rgba(45, 55, 65, 0.5)"; 
  ctx.fill();
  
  // Selection Highlight - CHANGED: Cyan/Teal
  if(sel===i){
    ctx.beginPath(); ctx.arc(n.x,n.y,25,0,Math.PI*2); 
    ctx.fillStyle = "rgba(0, 200, 255, 0.3)"; 
    ctx.fill();
    ctx.strokeStyle = "#c5d8e6"; ctx.lineWidth = 2; ctx.stroke();
  }
 });

 // Draw Pieces
 N.forEach((n,i)=>{
   if(animState.active && animState.toIdx === i) return; 
   if(board[i]) drawPiece(n.x, n.y, board[i]);
 });

 // Animation
 if(animState.active){
   const startPos = N[animState.fromIdx], endPos = N[animState.toIdx];
   const curX = startPos.x + (endPos.x - startPos.x) * animState.progress;
   const curY = startPos.y + (endPos.y - startPos.y) * animState.progress;
   drawPiece(curX, curY, animState.player);
   animState.progress += 0.20; 
   if(animState.progress < 1) requestAnimationFrame(draw); else { animState.active = false; draw(); }
 }
}

function drawPiece(x, y, type){
  ctx.font = "42px Segoe UI Symbol"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
  
  // Shadow
  ctx.fillStyle = "rgba(0,0,0,0.4)"; ctx.fillText("♟", x+3, y+3);
  
  if(type === "BLUE"){ 
    // White Player (Now Chrome/Silver)
    ctx.fillStyle = "#e8f1f5"; 
    ctx.fillText("♟", x, y);
    ctx.lineWidth = 1; ctx.strokeStyle = "#252d33"; ctx.strokeText("♟", x, y);
  } else { 
    // Black Player (Now Matte Gunmetal)
    ctx.fillStyle = "#12161a"; 
    ctx.fillText("♟", x, y);
    ctx.lineWidth = 1; ctx.strokeStyle = "#7a8b99"; ctx.strokeText("♟", x, y);
  }
}

function valid(a,b){
 return board[b]==null && L.some(l=>(l[0]==a&&l[1]==b)||(l[1]==a&&l[0]==b));
}

function win(p){
  return W.some(line => {
    if (p==="RED" && line.join()==="0,1,2,3") return false;
    if (p==="BLUE" && line.join()==="12,13,14,15") return false;
    return line.every(i => board[i]===p);
  });
}

function doMove(a,b){
 let movingPlayer = board[a]; 
 board[a]=null; board[b]=turn;
 playWoodSound();
 animState = { active: true, fromIdx: a, toIdx: b, progress: 0, player: movingPlayer };
 
 if(win(turn)){
   animState.active = false; draw();
   setTimeout(()=>{alert((turn=="BLUE"?"WHITE":"BLACK")+" WINS!");resetGame();}, 50);
   return;
 }
 
 turn=turn=="BLUE"?"RED":"BLUE";
 document.getElementById("turn").innerText="TURN: "+(turn=="BLUE"?"WHITE":"BLACK");
 draw(); 
 
 if(mode === "AI-VS-AI") {
     setTimeout(aiMove, 600);
 } else if(turn=="RED" && mode!=="2P") {
     setTimeout(aiMove, 450);
 }
}

function possibleMoves(p){
 let res=[];
 board.forEach((v,i)=>{
  if(v==p) L.forEach(l=>{
   let t=l[0]==i?l[1]:l[1]==i?l[0]:null;
   if(t!==null && board[t]==null) res.push([i,t]);
  });
 });
 return res;
}

function aiMove(){
 let p = turn;
 let moves = possibleMoves(p);
 if(moves.length === 0) return; 

 if(mode=="EASY" && p=="RED"){
  let m=moves[Math.random()*moves.length|0]; doMove(m[0],m[1]); return;
 }
 if(mode=="MEDIUM" && p=="RED"){
  for(let m of moves){
   let save=[...board]; board[m[0]]=null; board[m[1]]="RED";
   if(win("RED")){board=save;doMove(m[0],m[1]);return;} board=save;
  }
  for(let m of moves){
   let save=[...board]; board[m[0]]=null; board[m[1]]="BLUE";
   if(win("BLUE")){board=save;doMove(m[0],m[1]);return;} board=save;
  }
  let m=moves[Math.random()*moves.length|0]; doMove(m[0],m[1]); return;
 }

 let bestScore = (p === "RED") ? -9999 : 9999;
 let bestMove = moves[Math.random()*moves.length|0];
 moves.sort(() => Math.random() - 0.5);

 moves.forEach(m=>{
  let save=[...board];
  board[m[0]]=null; board[m[1]]=p;
  let s = minimax((p === "BLUE"), 0); 
  board=save;
  if (p === "RED") { if(s > bestScore){ bestScore=s; bestMove=m; } } 
  else { if(s < bestScore){ bestScore=s; bestMove=m; } }
 });
 doMove(bestMove[0], bestMove[1]);
}

function minimax(max, depth){
 if(win("RED")) return 100-depth;
 if(win("BLUE")) return depth-100;
 if(depth >= 3) return 0; 

 let p=max?"RED":"BLUE";
 let moves=possibleMoves(p);
 if(moves.length === 0) return 0; 
 let best=max?-9999:9999;
 
 for(let m of moves){
  let save=[...board];
  board[m[0]]=null; board[m[1]]=p;
  let s=minimax(!max, depth+1);
  board=save;
  best=max?Math.max(best,s):Math.min(best,s);
 }
 return best;
}

c.onclick=e=>{
 if(audioCtx.state === 'suspended') audioCtx.resume();
 if(mode === "AI-VS-AI") return; 
 if(animState.active) return;
 
 let r=c.getBoundingClientRect(),x=e.clientX-r.left,y=e.clientY-r.top;
 N.forEach((n,i)=>{
  if(Math.hypot(x-n.x,y-n.y)<35){ 
   if(sel==null){
    if(board[i]==turn) sel=i;
   }else{
    if(valid(sel,i)) doMove(sel,i);
    sel=null;
   }
  }
 });
 draw();
};
draw();
</script>
</body>
</html>
